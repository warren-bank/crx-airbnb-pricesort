const sort_stays_by_final_price = function() {
  let stays = [...document.querySelectorAll('div._fhph4u > div._8ssblpx')]

  // sanity check
  if (!stays.length) return

  const get_stay_price = function(el) {
    let txt, num

    txt = el.querySelector('div._75kbg2 > div._hgs47m > div._10ejfg4u > div._1h25vrn > span._qlq27g > div._61b3pa > span > div > span > span._j2qalb2 > span._j2qalb2')

    // sanity check
    if (!txt) return 0

    txt = txt.innerText.replace(/[^0-9\.]/g, '')
    num = Number(txt)

    return num
  }

  const stays_compare = function(a, b) {
    const a_price = get_stay_price(a)
    const b_price = get_stay_price(b)

    return (a_price < b_price)? -1 : (a_price === b_price)? 0 : 1
  }

  const update_dom = function() {
    const parent = stays[0].parentNode

    // empty
    while (parent.hasChildNodes()) {
      parent.removeChild(
        parent.firstChild
      )
    }

    // add stays sorted by final price
    stays.forEach(parent.appendChild.bind(parent))
  }

  stays.sort(stays_compare)
  console.log(stays.map(get_stay_price))

  update_dom()
}

const inject_button = function() {
  const menu = document.querySelector('div._ouyf9j > div._m7x2lq > div > div._i8vcof')

  // sanity check
  if (!menu) return

  const button = document.createElement('button')
  button.classList.add('_1jl6sxj4')
  button.innerText = 'Sort by Final Price'
  button.addEventListener('click', sort_stays_by_final_price, false)

  menu.appendChild(button)
}

inject_button()
